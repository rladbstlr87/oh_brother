# 파일 처리 (File Processing)

## 1. 파일 형식에 따른 동적 텍스트 추출 파이프라인

### 핵심 개념
- 입력된 파일의 종류(PDF, 이미지 등)를 먼저 식별하고, 각 형식에 가장 효율적인 도구와 로직을 동적으로 적용하여 최종 결과물(텍스트)을 얻는 방식
- Tesseract OCR: 이미지 속 글자를 인식하는 광학 문자 인식 엔진. 이미지 기반의 모든 파일 처리의 최종 단계.
- pdfplumber: 텍스트 기반 PDF에서 내장된 텍스트를 직접, 빠르고 정확하게 추출하는 라이브러리.
- pdf2image: PDF 페이지를 이미지 파일로 변환하는 라이브러리. Tesseract가 PDF를 처리할 수 있도록 돕는 중간 다리 역할.

### For example (동적 파이프라인을 통해 할 수 있는 것)

#### ex.1-1: 다양한 문서 형식의 통합 처리
- 사용자가 워드에서 바로 저장한 텍스트 기반 PDF를 올리든, 스캐너로 스캔한 이미지 기반 PDF를 올리든, 스마트폰으로 찍은 JPG 사진을 올리든, 시스템은 동일한 `process_document` 태스크를 통해 모두 처리 가능
- 내부적으로 파일 확장자와 내용을 분석하여 최적의 경로(텍스트 직접 추출 or OCR)를 자동으로 선택하므로, 사용자는 파일 형식에 대해 전혀 신경 쓸 필요가 없음

#### ex.1-2: 자원의 효율적 사용
- 모든 PDF를 무조건 이미지로 변환 후 OCR하는 방식은 매우 느리고 CPU 자원을 많이 소모함
- 텍스트 직접 추출을 먼저 시도하고, 실패할 경우에만 OCR을 실행하는 현재의 파이프라인은 불필요한 자원 낭비를 최소화하여 더 빠르고 경제적으로 시스템을 운영할 수 있게 함

### What it can do? (더 복잡한 활용)

#### ex.level.2: 임시 파일의 안전한 관리 (`tempfile`)
- `pdf2image`가 PDF를 처리하며 생성하는 중간 이미지 파일들이 디스크에 그대로 남으면 저장 공간을 낭비하고 관리를 어렵게 만듦
- 파이썬의 `tempfile.TemporaryDirectory()`를 `with` 구문과 함께 사용하면, 코드 블록 내에서 생성된 모든 파일과 디렉토리가 블록 종료 시점에 자동으로, 그리고 안전하게 삭제됨. 이를 통해 시스템을 항상 깨끗한 상태로 유지 가능
  ```python
  import tempfile
  from pdf2image import convert_from_path

  with tempfile.TemporaryDirectory() as temp_path:
      # pdf 페이지들이 temp_path 안에 이미지 파일로 생성됨
      images = convert_from_path(pdf_file, output_folder=temp_path)
      # ... OCR 및 기타 처리 ...
  # with 블록이 끝나면 temp_path와 그 안의 이미지들이 모두 자동으로 사라짐
  ```

#### ex.level.3: 다중 페이지 문서의 선별적 처리
- 현재 로직을 확장하여, 20페이지짜리 PDF 문서에서 텍스트가 가장 많이 포함된 '핵심 페이지' 3개만 자동으로 찾아내어 OCR을 실행하고, 나머지는 버리는 식의 지능적인 처리도 가능
- 또는, 정규표현식을 이용해 '목차'나 '시간표' 같은 특정 키워드가 포함된 페이지만 이미지로 변환하여 저장하는 등, 문서의 내용에 기반한 고도로 자동화된 처리 로직을 구현할 수 있음